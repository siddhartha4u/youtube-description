<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Description Generator</title>
    <!-- Use Tailwind CSS for a modern and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app container */
        body {
            background-color: #1b1c2b; /* Dark navy background */
            font-family: 'Inter', sans-serif;
            color: #a0a3a7; /* Light gray text for contrast */
            /* Use flexbox for vertical and horizontal centering */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #app-container {
            max-width: 960px;
            width: 100%;
            padding: 2rem;
            background-color: #2d2e3a; /* Slightly lighter dark background for the card */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 1rem;
        }
        textarea, input {
            resize: vertical;
            background-color: #3b3c4f; /* Darker input background */
            color: white;
            border-color: #55576a;
        }
        h1 {
            color: #7f5af0; /* Vibrant purple for the title */
        }
    </style>
</head>
<body>
<input type="password" id="apiKey" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="AIzaSyC3m6k8ONG67lMr3YMEGT4svIWaYxig-BY">
    <div id="app-container">
        <h1 class="text-4xl font-bold text-center mb-6">YouTube Description Generator</h1>
        <p class="text-center mb-8">Quickly generate 5 engaging YouTube descriptions with a title and keywords.</p>

        <!-- Input Form Section -->
        <div class="space-y-4"> <!-- Reduced spacing here from space-y-6 to space-y-4 -->
            <div>
                <label for="apiKey" class="block text-sm font-medium">Google API Key</label>
                <input type="password" id="apiKey" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="Enter your Google API Key here">
            </div>

            <div>
                <label for="youtubeTitle" class="block text-sm font-medium">YouTube Title</label>
                <textarea id="youtubeTitle" rows="2" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"></textarea>
            </div>

            <div>
                <label for="primaryKeyword" class="block text-sm font-medium">Primary Keyword</label>
                <input type="text" id="primaryKeyword" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
            </div>
            
            <div>
                <label for="secondaryKeywords" class="block text-sm font-medium">Secondary Keywords (up to 5, separated by commas)</label>
                <textarea id="secondaryKeywords" rows="2" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="e.g., video editing, cinematic looks, sound design"></textarea>
            </div>

            <button id="generateBtn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-[#7f5af0] hover:bg-[#6849d4] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                Generate Descriptions
            </button>
            <div id="loading" class="text-center text-gray-400 font-medium hidden">Generating descriptions...</div>
        </div>

        <!-- Output Section for Descriptions -->
        <div id="resultsContainer" class="mt-12 space-y-8">
            <!-- Descriptions will be injected here -->
        </div>

    </div>

    <!-- The core JavaScript logic -->
    <script>
        // Set up global variables
        const apiKeyInput = document.getElementById('apiKey');
        const generateBtn = document.getElementById('generateBtn');
        const loadingDiv = document.getElementById('loading');
        const resultsContainer = document.getElementById('resultsContainer');
        const youtubeTitleInput = document.getElementById('youtubeTitle');
        const primaryKeywordInput = document.getElementById('primaryKeyword');
        const secondaryKeywordsInput = document.getElementById('secondaryKeywords');

        // Main event listener for the button click
        generateBtn.addEventListener('click', async () => {
            const apiKey = apiKeyInput.value.trim();
            const title = youtubeTitleInput.value.trim();
            const primaryKeyword = primaryKeywordInput.value.trim();
            const secondaryKeywords = secondaryKeywordsInput.value.trim();

            // Input validation
            if (!apiKey) {
                alertUser('Please enter your Google API Key.');
                return;
            }
            if (!title || !primaryKeyword) {
                alertUser('Please provide a YouTube Title and a Primary Keyword.');
                return;
            }

            // Show loading state
            toggleLoading(true);
            resultsContainer.innerHTML = ''; // Clear previous results

            try {
                // Construct the prompt for the generative model
                const prompt = `
                Act as a professional YouTube description writer. Your goal is to create 5 unique, engaging, and SEO-friendly video descriptions.
                Each description should be between 100 and 120 words long.
                
                Video Title: "${title}"
                Primary Keyword: "${primaryKeyword}"
                Secondary Keywords: "${secondaryKeywords}"
                
                For each description, please:
                1. Naturally incorporate the primary and secondary keywords.
                2. Be compelling and informative.
                3. Do not include a title, just the description text.
                4. Start each description with "Description 1:", "Description 2:", and so on.
                
                Return the 5 descriptions as a single block of text.
                `;

                // Set up the API call payload
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let retryCount = 0;
                let maxRetries = 3;
                let delay = 1000; // 1 second

                // Implement exponential backoff for API retries
                while (retryCount < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            // Too many requests, retry with delay
                            retryCount++;
                            if (retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, delay));
                                delay *= 2; // Exponential backoff
                                continue;
                            } else {
                                throw new Error('Too many requests. Please try again later.');
                            }
                        }

                        if (!response.ok) {
                            throw new Error(`API request failed with status: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            displayDescriptions(text);
                            break; // Exit the loop on success
                        } else {
                            throw new Error('Unexpected API response structure.');
                        }
                    } catch (error) {
                        if (retryCount >= maxRetries) {
                            throw error;
                        }
                        retryCount++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }

            } catch (error) {
                console.error('Error generating descriptions:', error);
                
                let userMessage = 'An unexpected error occurred. Please try again.';
                // Provide more specific error messages to the user
                if (error.message.includes('400')) {
                    userMessage = 'Invalid request. Please check your input fields.';
                } else if (error.message.includes('403') || error.message.includes('401')) {
                    userMessage = 'The provided API key is invalid or not authorized. Please check your API key.';
                } else if (error.message.includes('Too many requests')) {
                    userMessage = 'You have made too many requests. Please try again later.';
                }

                alertUser(userMessage);

            } finally {
                // Hide loading state
                toggleLoading(false);
            }
        });

        /**
         * Parses the API response and displays the descriptions.
         * @param {string} rawText - The raw text from the API, containing the 5 descriptions.
         */
        function displayDescriptions(rawText) {
            const descriptions = rawText.split(/Description \d+:/).filter(Boolean);
            
            descriptions.forEach((desc, index) => {
                const descDiv = document.createElement('div');
                descDiv.classList.add('p-6', 'bg-[#3b3c4f]', 'rounded-lg', 'shadow-md', 'border', 'border-[#55576a]', 'text-[#a0a3a7]');
                descDiv.innerHTML = `
                    <h3 class="font-bold text-lg text-[#7f5af0] mb-2">Description ${index + 1}</h3>
                    <p class="whitespace-pre-wrap">${desc.trim()}</p>
                `;
                resultsContainer.appendChild(descDiv);
            });
        }

        /**
         * Toggles the loading state of the UI.
         * @param {boolean} isLoading - True to show loading, false to hide.
         */
        function toggleLoading(isLoading) {
            if (isLoading) {
                generateBtn.disabled = true;
                generateBtn.classList.add('bg-[#6849d4]', 'cursor-not-allowed');
                loadingDiv.classList.remove('hidden');
            } else {
                generateBtn.disabled = false;
                generateBtn.classList.remove('bg-[#6849d4]', 'cursor-not-allowed');
                generateBtn.classList.add('bg-[#7f5af0]');
                loadingDiv.classList.add('hidden');
            }
        }

        /**
         * Displays a custom alert message to the user.
         * @param {string} message - The message to display.
         */
        function alertUser(message) {
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('fixed', 'inset-0', 'flex', 'items-center', 'justify-center', 'bg-black', 'bg-opacity-50', 'z-50');
            alertDiv.innerHTML = `
                <div class="bg-[#2d2e3a] p-6 rounded-lg shadow-xl max-w-sm mx-auto text-[#a0a3a7]">
                    <p class="text-center mb-4">${message}</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full py-2 px-4 bg-[#7f5af0] text-white rounded-md hover:bg-[#6849d4]">OK</button>
                </div>
            `;
            document.body.appendChild(alertDiv);
        }
    </script>
</body>
</html>
