<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YouTube Description Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #0d1117; }
    /* Custom style for file input */
    input[type="file"]::file-selector-button {
      background-color: #4b5563; /* Tailwind gray-600 */
      color: #fff;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    input[type="file"]::file-selector-button:hover {
      background-color: #374151; /* Tailwind gray-700 */
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // The API key is left as an empty string to be filled by the environment
    const apiKey = "AIzaSyC3m6k8ONG67lMr3YMEGT4svIWaYxig-BY";
    
    // Global state variables for the application
    let appState = {
      title: "",
      primaryKeyword: "",
      secondaryKeywords: ["", "", "", "", ""],
      descriptions: [],
      loading: false,
      error: ""
    };

    /**
     * Helper function to copy text to the clipboard.
     * Uses the document.execCommand() method as recommended for this environment.
     * @param {string} text - The text to be copied.
     */
    const copyToClipboard = text => {
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
    };

    /**
     * Generates the SVG for a loading spinner.
     * @returns {string} The SVG string.
     */
    const spinner = () => `
      <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
      </svg>`;

    /**
     * Renders the entire application UI based on the current appState.
     */
    const render = () => {
      const app = document.getElementById("app");
      const { title, primaryKeyword, secondaryKeywords, descriptions, loading, error } = appState;

      app.innerHTML = `
        <div class="min-h-screen bg-gray-900 text-white p-4 sm:p-8 flex justify-center">
          <div class="bg-gray-800 p-6 sm:p-10 rounded-xl shadow-2xl w-full max-w-4xl">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
              YouTube Description Generator ✍️
            </h1>
            <p class="text-center text-gray-400 mb-6">Fill in the details below to generate SEO-friendly video descriptions</p>

            <!-- YouTube Title -->
            <div class="mb-4">
              <label for="title-input" class="block mb-2 text-gray-300 font-bold">YouTube Video Title</label>
              <input id="title-input" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" value="${title}" placeholder="e.g. Best AI Tools for Students in 2025" />
            </div>

            <!-- Primary Keyword -->
            <div class="mb-4">
              <label for="primary-keyword-input" class="block mb-2 text-gray-300 font-bold">Primary Keyword</label>
              <input id="primary-keyword-input" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" value="${primaryKeyword}" placeholder="Required keyword e.g. AI tools" />
            </div>

            <!-- Secondary Keywords -->
            <div class="mb-6">
              <label class="block mb-2 text-gray-300 font-bold">Secondary Keywords (Optional - Max 5)</label>
              ${secondaryKeywords.map((kw, i) => `
                <input id="secondary-keyword-input-${i}" class="w-full mb-2 p-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 secondary-keyword" data-index="${i}" value="${kw}" placeholder="Secondary Keyword ${i + 1}" />
              `).join('')}
            </div>

            <!-- Generate Button -->
            <button id="generateBtn" ${loading ? "disabled" : ""}
              class="w-full p-4 rounded-lg font-bold text-white transition-all
              ${loading
                ? 'bg-gray-600 cursor-not-allowed'
                : 'bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 transform hover:scale-105'}">
              ${loading ? spinner() : "Generate Descriptions"}
            </button>

            ${error ? `<p class="text-red-400 text-center mt-4 text-sm">${error}</p>` : ""}

            <!-- Output Descriptions -->
            ${descriptions.length > 0
              ? `<div class="mt-8">
                  <h2 class="text-2xl text-center text-gray-200 mb-4 font-bold">Generated Descriptions</h2>
                  <div class="space-y-4">
                    ${descriptions.map((desc, index) => `
                      <div class="bg-gray-700 p-4 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <p class="text-white mb-2 sm:mb-0 whitespace-pre-line flex-grow">${desc}</p>
                        <button class="copy-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold flex-shrink-0" data-index="${index}">
                          Copy
                        </button>
                      </div>`).join('')}
                  </div>
                </div>`
              : ""}
          </div>
        </div>`;
      
      // After rendering, attach event listeners to the new elements
      addEventListeners();
    };

    /**
     * Attaches event listeners to the rendered DOM elements.
     */
    const addEventListeners = () => {
      // Input listeners
      document.getElementById("title-input").oninput = e => {
        appState.title = e.target.value;
      };
      document.getElementById("primary-keyword-input").oninput = e => {
        appState.primaryKeyword = e.target.value;
      };
      document.querySelectorAll(".secondary-keyword").forEach(input => {
        input.oninput = e => {
          appState.secondaryKeywords[parseInt(e.target.dataset.index)] = e.target.value;
        };
      });

      // Generate button listener
      document.getElementById("generateBtn").onclick = generateDescriptions;
      
      // Copy buttons listener
      document.querySelectorAll(".copy-btn").forEach(btn => {
        btn.onclick = () => {
          const index = parseInt(btn.dataset.index);
          copyToClipboard(appState.descriptions[index]);
          // Add a temporary visual feedback for copying
          const originalText = btn.textContent;
          btn.textContent = "Copied!";
          setTimeout(() => {
            btn.textContent = originalText;
          }, 1500);
        };
      });
    };

    /**
     * Calls the Gemini API to generate descriptions based on the input keywords.
     */
    const generateDescriptions = async () => {
      // Input validation
      if (!appState.primaryKeyword.trim()) {
        appState.error = "Primary keyword is required.";
        render();
        return;
      }

      // Update state for loading and reset previous results
      appState.loading = true;
      appState.error = "";
      appState.descriptions = [];
      render();

      const filteredSecondaries = appState.secondaryKeywords.filter(k => k.trim());
      const prompt = `
        Generate a JSON array of 5 unique YouTube video descriptions.
        Each description should:
        - Be between 100 to 120 words.
        - Start with an attention-grabbing hook.
        - Include the exact primary keyword: "${appState.primaryKeyword}".
        - Include as many of the following secondary keywords as naturally possible: ${filteredSecondaries.join(", ") || "None"}.
        - Explain what the video offers in 2 sentences.
        - Contain 1 strong call-to-action.
        - End with 2-3 trending and relevant hashtags.
        - Do NOT include the title in the output. Just the descriptions.
      `;
      
      const payload = {
        contents: [{ role: "user", parts: [{ text: prompt }] }],
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: { type: "ARRAY", items: { type: "STRING" } }
        }
      };

      try {
        let response;
        let attempts = 0;
        const maxAttempts = 3;
        const baseDelay = 1000; // 1 second

        // Implement exponential backoff for API calls
        while (attempts < maxAttempts) {
          try {
            response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload)
            });

            if (response.status === 429) { // Too Many Requests
              const delay = baseDelay * Math.pow(2, attempts);
              await new Promise(resolve => setTimeout(resolve, delay));
              attempts++;
              continue; // Retry the request
            }

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const json = await response.json();
            const content = json?.candidates?.[0]?.content?.parts?.[0]?.text;
            const parsed = JSON.parse(content);
            appState.descriptions = Array.isArray(parsed) ? parsed : [];
            break; // Exit the loop on success
          } catch (e) {
            console.error("API call error:", e);
            appState.error = "Something went wrong with the API call. Try again later.";
            break; // Exit the loop on other errors
          }
        }
      } catch (e) {
        console.error("Fetch failed:", e);
        appState.error = "Something went wrong. Please check your network connection.";
      }

      // Reset loading state and re-render the UI with new data
      appState.loading = false;
      render();
    };

    // Initial render when the page loads
    render();
  </script>
</body>
</html>
